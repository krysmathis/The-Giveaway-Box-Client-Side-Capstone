<div ng-controller="AddListingCtrl as filter">
    <div class="container">
    <h1 class="section__header">Add Listings</h1>
    <div class="row"> <!-- main row -->
        <div class="col-md-7"><!-- the form section -->
             <!-- <button type="button" ng-click="reload()">RELOAD</button> -->
            <form name='myForm'>
                    <div class="form-group row">
                        <label class="col-sm-3 col-form-label font-weight-bold" >Item Label</label>
                        <div class="col-sm-9">
                            <input class="form-control" type="text" ng-model="item.label" placeholder="heading for your item" value="Baby stroller" required>
                        </div>
                    </div>
                    <div class="form-group row">
                        <label class="col-sm-3 col-form-label font-weight-bold">Item Description</label>
                        <div class="col-sm-9">
                            <textarea class="form-control" ng-model="item.desc"></textarea>
                        </div>
                        <!-- <input type="text" ng-model="item.desc" placeholder="description" value="Baby stroller"> -->
                    </div>
                    <div class="form-group row">
                        <label for="Category" class="col-sm-3 col-form-label font-weight-bold">Category</label>
                        <div class="col-sm-9">
                            <select class="form-control" ng-model="selectedCategory" ng-change="getSubCategories()" data-ng-options="cat as cat.label for cat in categories track by cat.value"></select>
                            <small id="addListing__category-help" class="form-text text-muted">Help other find your items by putting it into the right category.</small>
                        </div>
                    </div>
                    <div class="form-group row">
                        <label class="col-sm-3 col-form-label font-weight-bold">SubCategory</label>
                        <div class="col-sm-9">
                            <select class="form-control" ng-model="selectedSubCategory" ng-change="getAttributes()" data-ng-options="cat as cat.label for cat in subCategories track by cat.value">
                                <!-- <option ng-repeat="cat in subCategories" value="{{cat.value}}" ng-selected='cat.isSelected'>{{cat.label}}</option> -->
                            </select>
                            <small id="addListing__subCategory-help" class="form-text text-muted">We'll provide you with a few more options after this...</small>
                        </div>
                    </div>
                    <div class="form-group row">
                        <label class="col-sm-3 col-form-label font-weight-bold" for="Retail Price">Asking Price</label>
                        <div class="col-sm-9">
                            <input class="form-control" type="text" ng-model="item.price" placeholder="Leave blank if this is a donation" value="1.00">
                        </div>
                    </div>
                    <div class="form-group row">
                        <label class="col-sm-3 col-form-label font-weight-bold" for="Image">Image</label>
                        <div class="col-sm-9">
                            <div class="addListing___image">
                                <!-- <img ng-src="{{item.image}}" style="width:150px;height:auto;"/> -->
                            </div>
                            <div>
                                <label class="btn btn-primary btn-file">
                                    Add Image
                                    <input  class="hidden" id="addListing__image" custom-on-change="uploadFile" type="file" accept=".jpg,.png,.gif" ng-model="item.image" ng-change="saveImage()">
                                </label>
                                <span ng-if="displayProgress" class="progress-line"></span>
                            </div>
                        </div>
                    </div>
                    <!-- date picker -->
                    <div class="form-group row">
                        <label class="col-sm-3 col-form-label font-weight-bold">Expiration</label>
                        <div class="col-sm-9">
                            <div class="input-group"
                                moment-picker="item.expirationDate"
                                format="YYYY-MM-DD"
                                min-date="minDateString">
                                <input class="form-control"
                                placeholder="Select a date"
                                ng-model="item.expirationDate"
                                ng-model-options="{ updateOn: 'blur' }">
                                <span class="input-group-addon">
                                    <i class="fa fa-calendar" aria-hidden="true"></i>
                                </span>
                            </div>
                                <small id="addListing__expiration-help" class="form-text text-muted">If you'd like, we can remove this listing on a set date</small>
                        </div>
                    </div>

                    <h1 class="section__header">Attributes</h1>
                    <!-- UPDATE MODE - JUST SHOW THE ATTRIBUTES UNLESS THE CATEGORY IS UPDATED -->
                    <div ng-if="inUpdateMode()">    
                        <div ng-repeat="field in item.attributes">
                                {{field.label}}: {{field.value}}
                        </div>
                    </div>
                    <div ng-if="!inUpdateMode()" ng-repeat="field in attributeModel" ng-form='subForm'>
                        <div class="form-group row" ng-if='field.data_type == "text"'>
                            <label class="col-sm-3 col-form-label">{{field.label}}</label>
                            <div class="col-sm-9">
                                <input class="form-control"  type='text' ng-model='field.value' placeholder='{{field.label}}' name='myText' />
                                <span class='required' ng-show="subForm.myText.$error.required">*</span>
                            </div>
                        </div>
                        <div class="form-group row" ng-if='field.data_type == "email"'>
                            <input class="form-control"  type='email' ng-model='field.value' placeholder='{{field.label}}' name='myEmail' />
                            <span class='required' ng-show="subForm.myEmail.$error.required">*</span>
                        </div>
                        <div ng-if='field.data_type === "file"'>
                            <label>{{field.label}}</label>
                            <input class="form-control"  type="file" ng-model='field.value' placeholder='{{field.label}}' name="myImage" />
                        </div>
                        <div class="form-group row" ng-if='field.data_type === "select"'>
                            <label class="col-sm-3">{{field.label}}</label>
                            <div class="col-sm-9">
                                <select class="form-control"  ng-model='field.value'>
                                    <option ng-repeat='m in field.viewModel' value="{{m.value}}">{{m.value}}</option>
                                </select>
                            </div>
                        </div>
                    </div><!-- end of attributes -->
                    <h1 class="section__header">Enter Tags</h1>
                    <div class="entry__tags">
                        <span ng-repeat="tag in tags track by $index">
                            <span class="btn btn-default btn-sm" ng-click="removeTag($event)">{{tag}}</span>
                        </span>
                        <input class="add-listing__tag-input" type="text" ng-model="newTag" ng-keydown="updateTags($event)" placeholder="tag" />
                    </div>
                    <p></p>
                    <div>
                        <input class="btn btn-primary" style="width:100%;"type='button' ng-click="submitListing()" value='submit form' ng-disabled='myForm.$invalid' />
                    </div>
                </form>
            </form>
        </div> <!-- end of form section -->
        <!-- second card section -->
        <div class="col-md-5 mt-4">
            <div class="card card-inverse card-info flip-container" ontouchstart="this.classList.toggle('hover');">
                <div class="flipper">
                    <div class="front">
                        <img class="card-img-top" ng-src="{{item.image}}" alt="Card image cap">
                    </div><!-- end of card-front -->
                    <div class="back">
                    </div>
                    </div> <!-- end of flipper -->
                        <div class="card-block">
                            <div class="add-listing__user ">
                                <figure class="profile" popover-append-to-body="true" uib-popover="I appeared on mouse enter!" popover-trigger="'mouseenter'" >
                                    <img src="http://success-at-work.com/wp-content/uploads/2015/04/free-stock-photos.gif" class="profile-avatar" alt="">
                                </figure>
                                <span class="add-listing__user-info">{{user.firstName}} {{user.lastName}}</span>
                            </div>
                            <div class="text-truncate">
                                <h4 class="card-title mt-3">{{item.label}}</h4>
                            </div>
                            <div class="card__price">
                                <span class="badge badge-info badge-price">{{getPrice()}}</span>
                            </div>
                            <div class="meta card-text">
                                <a></a>
                            </div>
                            <div class="card-text">
                                {{item.desc}}
                            </div>
                            <div class="listing__tag-container">
                                <span ng-repeat="tag in tags" class="btn btn-default btn-xs">
                                    {{tag}}
                                </span>
                            </div>
                        </div>
                    
                <div class="card-footer">
                    <small>Expiring in {{ daysUntilExpires() }} days</small>
                    <button class="btn btn-info float-right btn-sm">I want it!</button>
                </div>
            </div>
        </div> <!-- second card section -->
    </div> <!-- main row -->
    
</div>
   

</div>